stateDiagram-v2
    [*] --> 초기화
    초기화 --> 포트폴리오로드
    포트폴리오로드 --> 대화형모드 : interactive=True
    포트폴리오로드 --> 자동처리 : interactive=False
    
    대화형모드 --> 거래입력대기
    거래입력대기 --> 매수주문 : 'b' 입력
    거래입력대기 --> 매도주문 : 's' 입력
    거래입력대기 --> 가격책정 : Enter 입력
    
    매수주문 --> 시장가개장 : 'm' 선택
    매수주문 --> 지정가 : 'l' 선택
    
    시장가개장 --> 데이터조회
    지정가 --> 데이터조회
    매도주문 --> 데이터조회
    
    state 데이터조회 {
        [*] --> Yahoo시도
        Yahoo시도 --> Yahoo성공 : 데이터 있음
        Yahoo시도 --> Stooq시도 : 실패
        Stooq시도 --> Stooq성공 : 데이터 있음
        Stooq시도 --> StooqCSV시도 : 실패
        StooqCSV시도 --> StooqCSV성공 : 데이터 있음
        StooqCSV시도 --> 프록시시도 : 실패
        프록시시도 --> 프록시성공 : 데이터 있음
        프록시시도 --> 데이터없음 : 실패
        Yahoo성공 --> [*]
        Stooq성공 --> [*]
        StooqCSV성공 --> [*]
        프록시성공 --> [*]
        데이터없음 --> [*]
    }
    
    데이터조회 --> 거래실행 : 데이터 존재
    데이터조회 --> 거래실패 : 데이터 없음
    
    거래실행 --> 포트폴리오업데이트
    거래실패 --> 거래입력대기
    포트폴리오업데이트 --> 거래로그기록
    거래로그기록 --> 거래입력대기
    
    가격책정 --> 자동처리
    자동처리 --> 종목반복
    
    종목반복 --> 현재가조회
    현재가조회 --> 데이터조회
    데이터조회 --> 손절매확인 : 데이터 있음
    데이터조회 --> 데이터없음처리 : 데이터 없음
    
    손절매확인 --> 손절매실행 : 조건 충족
    손절매확인 --> 보유지속 : 조건 미충족
    
    손절매실행 --> 매도처리
    매도처리 --> 거래로그기록2[거래 로그 기록]
    보유지속 --> 가치계산
    데이터없음처리 --> 가치계산
    거래로그기록2 --> 다음종목확인
    가치계산 --> 다음종목확인
    
    다음종목확인 --> 종목반복 : 더 있음
    다음종목확인 --> CSV저장 : 완료
    
    CSV저장 --> 결과보고
    결과보고 --> 벤치마크조회
    벤치마크조회 --> 데이터조회
    데이터조회 --> 성과계산 : 각 벤치마크
    성과계산 --> CAPM분석
    CAMP분석 --> 결과출력
    결과출력 --> [*]